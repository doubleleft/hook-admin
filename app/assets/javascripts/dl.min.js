// 30/05/2014
// https://github.com/doubleleft/dl-api-javascript/blob/e8791f8b035452f865e02f2b8b51776e908be896/dist/dl.min.js
!function(a){"undefined"==typeof a.define&&(a.define=function(b,c){try{delete a.define}catch(d){a.define=void 0}"function"==typeof b?a.when=b():a[b]=c()},a.define.amd={}),function(a){"use strict";a(function(a){function b(a,b,c,d){return e(a).then(b,c,d)}function c(a){return new d(a,P.PromiseStatus&&P.PromiseStatus())}function d(a,b){function c(){return k?k.inspect():A()}function d(a,b,c,d,e){function f(f){f._when(a,b,c,d,e)}l?l.push(f):B(function(){f(k)})}function e(a){if(l){var c=l;l=T,k=j(h,a),B(function(){b&&o(k,b),i(c,k)})}}function f(a){e(new m(a))}function g(a){if(l){var b=l;B(function(){i(b,new n(a))})}}var h,k,l=[];h=this,this._status=b,this.inspect=c,this._when=d;try{a(e,f,g)}catch(p){f(p)}}function e(a){return a instanceof d?a:f(a)}function f(a){return c(function(b){b(a)})}function g(a){return b(a,function(a){return new m(a)})}function h(){function a(a,c,g){b.resolve=b.resolver.resolve=function(b){return e?f(b):(e=!0,a(b),d)},b.reject=b.resolver.reject=function(a){return e?f(new m(a)):(e=!0,c(a),d)},b.notify=b.resolver.notify=function(a){return g(a),a}}var b,d,e;return b={promise:T,resolve:T,reject:T,notify:T,resolver:{resolve:T,reject:T,notify:T}},b.promise=d=c(a),b}function i(a,b){for(var c=0;c<a.length;c++)a[c](b)}function j(a,b){if(b===a)return new m(new TypeError);if(b instanceof d)return b;try{var c=b===Object(b)&&b.then;return"function"==typeof c?k(c,b):new l(b)}catch(e){return new m(e)}}function k(a,b){return c(function(c,d){B(function(){try{J(a,b,c,d)}catch(e){d(e)}})})}function l(a){this.value=a}function m(a){this.value=a}function n(a){this.value=a}function o(a,b){function c(){b.fulfilled()}function d(a){b.rejected(a)}a.then(c,d)}function p(a){return a&&"function"==typeof a.then}function q(a,d,e,f,g){return b(a,function(a){function h(c,e,f){function g(a){n(a)}function h(a){m(a)}var i,j,k,l,m,n,o,p;if(o=a.length>>>0,i=Math.max(0,Math.min(d,o)),k=[],j=o-i+1,l=[],i)for(n=function(a){l.push(a),--j||(m=n=D,e(l))},m=function(a){k.push(a),--i||(m=n=D,c(k))},p=0;o>p;++p)p in a&&b(a[p],h,g,f);else c(k)}return c(h).then(e,f,g)})}function r(a,b,c,d){function e(a){return b?b(a[0]):a[0]}return q(a,1,e,c,d)}function s(a,b,c,d){return w(a,D).then(b,c,d)}function t(){return w(arguments,D)}function u(a){return w(a,y,z)}function v(a,b){return w(a,b)}function w(a,c,e){return b(a,function(a){function f(d,f,g){function h(a,h){b(a,c,e).then(function(a){i[h]=a,--k||d(i)},f,g)}var i,j,k,l;if(k=j=a.length>>>0,i=[],!k)return void d(i);for(l=0;j>l;l++)l in a?h(a[l],l):--k}return new d(f)})}function x(a,c){var d=J(I,arguments,1);return b(a,function(a){var e;return e=a.length,d[0]=function(a,d,f){return b(a,function(a){return b(d,function(b){return c(a,b,f,e)})})},H.apply(a,d)})}function y(a){return{state:"fulfilled",value:a}}function z(a){return{state:"rejected",reason:a}}function A(){return{state:"pending"}}function B(a){1===L.push(a)&&K(C)}function C(){i(L),L=[]}function D(a){return a}function E(a){throw"function"==typeof P.reportUnhandled?P.reportUnhandled():B(function(){throw a}),a}b.promise=c,b.resolve=f,b.reject=g,b.defer=h,b.join=t,b.all=s,b.map=v,b.reduce=x,b.settle=u,b.any=r,b.some=q,b.isPromise=p,b.isPromiseLike=p,F=d.prototype,F.then=function(a,b,c){var e=this;return new d(function(d,f,g){e._when(d,g,a,b,c)},this._status&&this._status.observed())},F["catch"]=F.otherwise=function(a){return this.then(T,a)},F["finally"]=F.ensure=function(a){function b(){return f(a())}return"function"==typeof a?this.then(b,b)["yield"](this):this},F.done=function(a,b){this.then(a,b)["catch"](E)},F["yield"]=function(a){return this.then(function(){return a})},F.tap=function(a){return this.then(a)["yield"](this)},F.spread=function(a){return this.then(function(b){return s(b,function(b){return a.apply(T,b)})})},F.always=function(a,b){return this.then(a,a,b)},G=Object.create||function(a){function b(){}return b.prototype=a,new b},l.prototype=G(F),l.prototype.inspect=function(){return y(this.value)},l.prototype._when=function(a,b,c){try{a("function"==typeof c?c(this.value):this.value)}catch(d){a(new m(d))}},m.prototype=G(F),m.prototype.inspect=function(){return z(this.value)},m.prototype._when=function(a,b,c,d){try{a("function"==typeof d?d(this.value):this)}catch(e){a(new m(e))}},n.prototype=G(F),n.prototype._when=function(a,b,c,d,e){try{b("function"==typeof e?e(this.value):this.value)}catch(f){b(f)}};var F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;if(R=a,L=[],P="undefined"!=typeof console?console:b,"object"==typeof process&&process.nextTick)K=process.nextTick;else if(S="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)K=function(a,b,c){var d=a.createElement("div");return new b(c).observe(d,{attributes:!0}),function(){d.setAttribute("x","x")}}(document,S,C);else try{K=R("vertx").runOnLoop||R("vertx").runOnContext}catch(U){Q=setTimeout,K=function(a){Q(a,0)}}return M=Function.prototype,N=M.call,J=M.bind?N.bind(N):function(a,b){return a.apply(b,I.call(arguments,2))},O=[],I=O.slice,H=O.reduce||function(a){var b,c,d,e,f;if(f=0,b=Object(this),e=b.length>>>0,c=arguments,c.length<=1)for(;;){if(f in b){d=b[f++];break}if(++f>=e)throw new TypeError}else d=c[1];for(;e>f;++f)f in b&&(d=a(d,b[f],f,b));return d},b})}("function"==typeof define&&define.amd?define:function(a){module.exports=a(require)}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("uxhr",b):a.uxhr=b()}(this,function(){"use strict";return function(b,c,d){c=c||"",d=d||{};var e=d.complete||function(){},f=d.success||function(){},g=d.error||function(){},h=d.timeout||0,i=d.ontimeout||function(){},j=d.onprogress||function(){},k=d.headers||{},l=d.method||"GET",m=d.sync||!1,n=function(){return 0===b.indexOf("http")&&"undefined"!=typeof XDomainRequest?new XDomainRequest:new XMLHttpRequest}();if(!n)throw new Error("Browser doesn't support XHR");var o="undefined"!=typeof a.FormData;if("string"!=typeof c&&o&&!(c instanceof a.FormData)){var p=[];for(var q in c)p.push(q+"="+c[q]);c=p.join("&")}if("GET"===l&&c&&(b+=b.indexOf("?")>=0?"&"+c:"?"+c),n.open(l,b,!m),"ontimeout"in n&&(n.timeout=h,n.ontimeout=i),"onprogress"in n&&(n.onprogress=j),n.onload=function(){e(n.responseText,n.status),f(n.responseText)},n.onerror=function(){e(n.responseText),g(n.responseText,n.status)},"undefined"!=typeof n.setRequestHeader)for(var r in k)n.setRequestHeader(r,k[r]);return n.send("GET"!==l?c:null),n}}),function(){function b(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function d(a,c){var d=typeof c;if(a=a.cache,"boolean"==d||null==c)return a[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:t+c;return a=(a=a[d])&&a[e],"object"==d?a&&b(a,c)>-1?0:-1:a?0:-1}function e(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:t+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function f(a){return a.charCodeAt(0)}function g(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function h(a){var b=-1,c=a.length,d=a[0],f=a[c/2|0],g=a[c-1];if(d&&"object"==typeof d&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;var h=k();h["false"]=h["null"]=h["true"]=h.undefined=!1;var i=k();for(i.array=a,i.cache=h,i.push=e;++b<c;)i.push(a[b]);return i}function i(a){return"\\"+X[a]}function j(){return q.pop()||[]}function k(){return r.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function l(a){a.length=0,q.length<v&&q.push(a)}function m(a){var b=a.cache;b&&m(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,r.length<v&&r.push(a)}function n(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function o(a){function c(a){return a&&"object"==typeof a&&!Zd(a)&&Hd.call(a,"__wrapped__")?a:new e(a)}function e(a,b){this.__chain__=!!b,this.__wrapped__=a}function q(a){function b(){if(d){var a=n(d);Id.apply(a,arguments)}if(this instanceof b){var f=v(c.prototype),g=c.apply(f,a||arguments);return Eb(g)?g:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Yd(b,a),b}function r(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Eb(a);if(!g)return a;var h=Ad.call(a);if(!T[h])return a;var i=Wd[h];switch(h){case M:case N:return new i(+a);case P:case S:return new i(a);case R:return f=i(a.source,B.exec(a)),f.lastIndex=a.lastIndex,f}var k=Zd(a);if(b){var m=!d;d||(d=j()),e||(e=j());for(var o=d.length;o--;)if(d[o]==a)return e[o];f=k?i(a.length):{}}else f=k?n(a):ee({},a);return k&&(Hd.call(a,"index")&&(f.index=a.index),Hd.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(k?Yb:he)(a,function(a,g){f[g]=r(a,b,c,d,e)}),m&&(l(d),l(e)),f):f}function v(a){return Eb(a)?Nd(a):{}}function X(a,b,c){if("function"!=typeof a)return Zc;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Xd.funcNames&&(d=!a.name),d=d||!Xd.funcDecomp,!d)){var e=Fd.call(a);Xd.funcNames||(d=!C.test(e)),d||(d=G.test(e),Yd(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Ic(a,b)}function Z(a){function b(){var a=i?g:this;if(e){var o=n(e);Id.apply(o,arguments)}if((f||k)&&(o||(o=n(arguments)),f&&Id.apply(o,f),k&&o.length<h))return d|=16,Z([c,l?d:-4&d,o,null,g,h]);if(o||(o=arguments),j&&(c=a[m]),this instanceof b){a=v(c.prototype);var p=c.apply(a,o);return Eb(p)?p:a}return c.apply(a,o)}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,l=8&d,m=c;return Yd(b,a),b}function $(a,c){var e=-1,f=ib(),g=a?a.length:0,i=g>=u&&f===b,j=[];if(i){var k=h(c);k?(f=d,c=k):i=!1}for(;++e<g;){var l=a[e];f(c,l)<0&&j.push(l)}return i&&m(c),j}function _(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Zd(h)||mb(h))){b||(h=_(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function ab(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var h=typeof a,i=typeof b;if(!(a!==a||a&&W[h]||b&&W[i]))return!1;if(null==a||null==b)return a===b;var k=Ad.call(a),m=Ad.call(b);if(k==K&&(k=Q),m==K&&(m=Q),k!=m)return!1;switch(k){case M:case N:return+a==+b;case P:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case R:case S:return a==vd(b)}var n=k==L;if(!n){var o=Hd.call(a,"__wrapped__"),p=Hd.call(b,"__wrapped__");if(o||p)return ab(o?a.__wrapped__:a,p?b.__wrapped__:b,c,d,e,f);if(k!=Q)return!1;var q=a.constructor,r=b.constructor;if(q!=r&&!(Db(q)&&q instanceof q&&Db(r)&&r instanceof r)&&"constructor"in a&&"constructor"in b)return!1}var s=!e;e||(e=j()),f||(f=j());for(var t=e.length;t--;)if(e[t]==a)return f[t]==b;var u=0;if(g=!0,e.push(a),f.push(b),n){if(t=a.length,u=b.length,g=u==t,g||d)for(;u--;){var v=t,w=b[u];if(d)for(;v--&&!(g=ab(a[v],w,c,d,e,f)););else if(!(g=ab(a[u],w,c,d,e,f)))break}}else ge(b,function(b,h,i){return Hd.call(i,h)?(u++,g=Hd.call(a,h)&&ab(a[h],b,c,d,e,f)):void 0}),g&&!d&&ge(a,function(a,b,c){return Hd.call(c,b)?g=--u>-1:void 0});return e.pop(),f.pop(),s&&(l(e),l(f)),g}function cb(a,b,c,d,e){(Zd(b)?Yb:he)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Zd(b))||ie(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Zd(j)?j:[]:ie(j)?j:{}),d.push(b),e.push(j),l||cb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function db(a,b){return a+Ed(Vd()*(b-a+1))}function eb(a,c,e){var f=-1,g=ib(),i=a?a.length:0,k=[],n=!c&&i>=u&&g===b,o=e||n?j():k;if(n){var p=h(o);g=d,o=p}for(;++f<i;){var q=a[f],r=e?e(q,f,a):q;(c?!f||o[o.length-1]!==r:g(o,r)<0)&&((e||n)&&o.push(r),k.push(q))}return n?(l(o.array),m(o)):e&&l(o),k}function fb(a){return function(b,d,e){var f={};d=c.createCallback(d,e,3);var g=-1,h=b?b.length:0;if("number"==typeof h)for(;++g<h;){var i=b[g];a(f,i,d(i,g,b),b)}else he(b,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function gb(a,b,c,d,e,f){var g=1&b,h=2&b,i=4&b,j=16&b,k=32&b;if(!h&&!Db(a))throw new wd;j&&!c.length&&(b&=-17,j=c=!1),k&&!d.length&&(b&=-33,k=d=!1);var l=a&&a.__bindData__;if(l&&l!==!0)return l=n(l),l[2]&&(l[2]=n(l[2])),l[3]&&(l[3]=n(l[3])),!g||1&l[1]||(l[4]=e),!g&&1&l[1]&&(b|=8),!i||4&l[1]||(l[5]=f),j&&Id.apply(l[2]||(l[2]=[]),c),k&&Ld.apply(l[3]||(l[3]=[]),d),l[1]|=b,gb.apply(null,l);var m=1==b||17===b?q:Z;return m([a,b,c,d,e,f])}function hb(a){return ae[a]}function ib(){var a=(a=c.indexOf)===rc?b:a;return a}function jb(a){return"function"==typeof a&&Bd.test(a)}function kb(a){var b,c;return a&&Ad.call(a)==Q&&(b=a.constructor,!Db(b)||b instanceof b)?(ge(a,function(a,b){c=b}),"undefined"==typeof c||Hd.call(a,c)):!1}function lb(a){return be[a]}function mb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==K||!1}function nb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),r(a,b,"function"==typeof c&&X(c,d,1))}function ob(a,b,c){return r(a,!0,"function"==typeof b&&X(b,c,1))}function pb(a,b){var c=v(a);return b?ee(c,b):c}function qb(a,b,d){var e;return b=c.createCallback(b,d,3),he(a,function(a,c,d){return b(a,c,d)?(e=c,!1):void 0}),e}function rb(a,b,d){var e;return b=c.createCallback(b,d,3),tb(a,function(a,c,d){return b(a,c,d)?(e=c,!1):void 0}),e}function sb(a,b,c){var d=[];ge(a,function(a,b){d.push(b,a)});var e=d.length;for(b=X(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function tb(a,b,c){var d=_d(a),e=d.length;for(b=X(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function ub(a){var b=[];return ge(a,function(a,c){Db(a)&&b.push(c)}),b.sort()}function vb(a,b){return a?Hd.call(a,b):!1}function wb(a){for(var b=-1,c=_d(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function xb(a){return a===!0||a===!1||a&&"object"==typeof a&&Ad.call(a)==M||!1}function yb(a){return a&&"object"==typeof a&&Ad.call(a)==N||!1}function zb(a){return a&&1===a.nodeType||!1}function Ab(a){var b=!0;if(!a)return b;var c=Ad.call(a),d=a.length;return c==L||c==S||c==K||c==Q&&"number"==typeof d&&Db(a.splice)?!d:(he(a,function(){return b=!1}),b)}function Bb(a,b,c,d){return ab(a,b,"function"==typeof c&&X(c,d,2))}function Cb(a){return Pd(a)&&!Qd(parseFloat(a))}function Db(a){return"function"==typeof a}function Eb(a){return!(!a||!W[typeof a])}function Fb(a){return Hb(a)&&a!=+a}function Gb(a){return null===a}function Hb(a){return"number"==typeof a||a&&"object"==typeof a&&Ad.call(a)==P||!1}function Ib(a){return a&&"object"==typeof a&&Ad.call(a)==R||!1}function Jb(a){return"string"==typeof a||a&&"object"==typeof a&&Ad.call(a)==S||!1}function Kb(a){return"undefined"==typeof a}function Lb(a,b,d){var e={};return b=c.createCallback(b,d,3),he(a,function(a,c,d){e[c]=b(a,c,d)}),e}function Mb(a){var b=arguments,c=2;if(!Eb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=X(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=n(arguments,1,c),f=-1,g=j(),h=j();++f<c;)cb(a,e[f],d,g,h);return l(g),l(h),a}function Nb(a,b,d){var e={};if("function"!=typeof b){var f=[];ge(a,function(a,b){f.push(b)}),f=$(f,_(arguments,!0,!1,1));for(var g=-1,h=f.length;++g<h;){var i=f[g];e[i]=a[i]}}else b=c.createCallback(b,d,3),ge(a,function(a,c,d){b(a,c,d)||(e[c]=a)});return e}function Ob(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Pb(a,b,d){var e={};if("function"!=typeof b)for(var f=-1,g=_(arguments,!0,!1,1),h=Eb(a)?g.length:0;++f<h;){var i=g[f];i in a&&(e[i]=a[i])}else b=c.createCallback(b,d,3),ge(a,function(a,c,d){b(a,c,d)&&(e[c]=a)});return e}function Qb(a,b,d,e){var f=Zd(a);if(null==d)if(f)d=[];else{var g=a&&a.constructor,h=g&&g.prototype;d=v(h)}return b&&(b=c.createCallback(b,e,4),(f?Yb:he)(a,function(a,c,e){return b(d,a,c,e)})),d}function Rb(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;)e[b]=a[c[b]];return e}function Sb(a){for(var b=arguments,c=-1,d=_(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=nd(e);++c<e;)f[c]=a[d[c]];return f}function Tb(a,b,c){var d=-1,e=ib(),f=a?a.length:0,g=!1;return c=(0>c?Sd(0,f+c):c)||0,Zd(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Jb(a)?a.indexOf(b,c):e(a,b,c))>-1:he(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Ub(a,b,d){var e=!0;b=c.createCallback(b,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&(e=!!b(a[f],f,a)););else he(a,function(a,c,d){return e=!!b(a,c,d)});return e}function Vb(a,b,d){var e=[];b=c.createCallback(b,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g;){var h=a[f];b(h,f,a)&&e.push(h)}else he(a,function(a,c,d){b(a,c,d)&&e.push(a)});return e}function Wb(a,b,d){b=c.createCallback(b,d,3);var e=-1,f=a?a.length:0;if("number"!=typeof f){var g;return he(a,function(a,c,d){return b(a,c,d)?(g=a,!1):void 0}),g}for(;++e<f;){var h=a[e];if(b(h,e,a))return h}}function Xb(a,b,d){var e;return b=c.createCallback(b,d,3),Zb(a,function(a,c,d){return b(a,c,d)?(e=a,!1):void 0}),e}function Yb(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:X(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else he(a,b);return a}function Zb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:X(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=_d(a);d=e.length,he(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function $b(a,b){var c=n(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=nd("number"==typeof f?f:0);return Yb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function _b(a,b,d){var e=-1,f=a?a.length:0;if(b=c.createCallback(b,d,3),"number"==typeof f)for(var g=nd(f);++e<f;)g[e]=b(a[e],e,a);else g=[],he(a,function(a,c,d){g[++e]=b(a,c,d)});return g}function ac(a,b,d){var e=-1/0,g=e;if("function"!=typeof b&&d&&d[b]===a&&(b=null),null==b&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];j>g&&(g=j)}else b=null==b&&Jb(a)?f:c.createCallback(b,d,3),Yb(a,function(a,c,d){var f=b(a,c,d);f>e&&(e=f,g=a)});return g}function bc(a,b,d){var e=1/0,g=e;if("function"!=typeof b&&d&&d[b]===a&&(b=null),null==b&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];g>j&&(g=j)}else b=null==b&&Jb(a)?f:c.createCallback(b,d,3),Yb(a,function(a,c,d){var f=b(a,c,d);e>f&&(e=f,g=a)});return g}function cc(a,b,d,e){if(!a)return d;var f=arguments.length<3;b=c.createCallback(b,e,4);var g=-1,h=a.length;if("number"==typeof h)for(f&&(d=a[++g]);++g<h;)d=b(d,a[g],g,a);else he(a,function(a,c,e){d=f?(f=!1,a):b(d,a,c,e)});return d}function dc(a,b,d,e){var f=arguments.length<3;return b=c.createCallback(b,e,4),Zb(a,function(a,c,e){d=f?(f=!1,a):b(d,a,c,e)}),d}function ec(a,b,d){return b=c.createCallback(b,d,3),Vb(a,function(a,c,d){return!b(a,c,d)})}function fc(a,b,c){if(a&&"number"!=typeof a.length&&(a=Rb(a)),null==b||c)return a?a[db(0,a.length-1)]:p;var d=gc(a);return d.length=Td(Sd(0,b),d.length),d}function gc(a){var b=-1,c=a?a.length:0,d=nd("number"==typeof c?c:0);return Yb(a,function(a){var c=db(0,++b);d[b]=d[c],d[c]=a}),d}function hc(a){var b=a?a.length:0;return"number"==typeof b?b:_d(a).length}function ic(a,b,d){var e;b=c.createCallback(b,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&!(e=b(a[f],f,a)););else he(a,function(a,c,d){return!(e=b(a,c,d))});return!!e}function jc(a,b,d){var e=-1,f=Zd(b),h=a?a.length:0,i=nd("number"==typeof h?h:0);for(f||(b=c.createCallback(b,d,3)),Yb(a,function(a,c,d){var g=i[++e]=k();f?g.criteria=_b(b,function(b){return a[b]}):(g.criteria=j())[0]=b(a,c,d),g.index=e,g.value=a}),h=i.length,i.sort(g);h--;){var n=i[h];i[h]=n.value,f||l(n.criteria),m(n)}return i}function kc(a){return a&&"number"==typeof a.length?n(a):Rb(a)}function lc(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function mc(a){return $(a,_(arguments,!0,!0,1))}function nc(a,b,d){var e=-1,f=a?a.length:0;for(b=c.createCallback(b,d,3);++e<f;)if(b(a[e],e,a))return e;return-1}function oc(a,b,d){var e=a?a.length:0;for(b=c.createCallback(b,d,3);e--;)if(b(a[e],e,a))return e;return-1}function pc(a,b,d){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=-1;for(b=c.createCallback(b,d,3);++g<f&&b(a[g],g,a);)e++}else if(e=b,null==e||d)return a?a[0]:p;return n(a,0,Td(Sd(0,e),f))}function qc(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=_b(a,c,d)),_(a,b)}function rc(a,c,d){if("number"==typeof d){var e=a?a.length:0;d=0>d?Sd(0,e+d):d||0}else if(d){var f=Ac(a,c);return a[f]===c?f:-1}return b(a,c,d)}function sc(a,b,d){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=c.createCallback(b,d,3);g--&&b(a[g],g,a);)e++}else e=null==b||d?1:b||e;return n(a,0,Td(Sd(0,f-e),f))}function tc(){for(var a=[],c=-1,e=arguments.length,f=j(),g=ib(),i=g===b,k=j();++c<e;){var n=arguments[c];(Zd(n)||mb(n))&&(a.push(n),f.push(i&&n.length>=u&&h(c?a[c]:k)))}var o=a[0],p=-1,q=o?o.length:0,r=[];a:for(;++p<q;){var s=f[0];if(n=o[p],(s?d(s,n):g(k,n))<0){for(c=e,(s||k).push(n);--c;)if(s=f[c],(s?d(s,n):g(a[c],n))<0)continue a;r.push(n)}}for(;e--;)s=f[e],s&&m(s);return l(f),l(k),r}function uc(a,b,d){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=c.createCallback(b,d,3);g--&&b(a[g],g,a);)e++}else if(e=b,null==e||d)return a?a[f-1]:p;return n(a,Sd(0,f-e))}function vc(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Sd(0,d+c):Td(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wc(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Kd.call(a,f--,1),e--);return a}function xc(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Sd(0,Cd((b-a)/(c||1))),f=nd(e);++d<e;)f[d]=a,a+=c;return f}function yc(a,b,d){var e=-1,f=a?a.length:0,g=[];for(b=c.createCallback(b,d,3);++e<f;){var h=a[e];b(h,e,a)&&(g.push(h),Kd.call(a,e--,1),f--)}return g}function zc(a,b,d){if("number"!=typeof b&&null!=b){var e=0,f=-1,g=a?a.length:0;for(b=c.createCallback(b,d,3);++f<g&&b(a[f],f,a);)e++}else e=null==b||d?1:Sd(0,b);return n(a,e)}function Ac(a,b,d,e){var f=0,g=a?a.length:f;for(d=d?c.createCallback(d,e,1):Zc,b=d(b);g>f;){var h=f+g>>>1;d(a[h])<b?f=h+1:g=h}return f}function Bc(){return eb(_(arguments,!0,!0))}function Cc(a,b,d,e){return"boolean"!=typeof b&&null!=b&&(e=d,d="function"!=typeof b&&e&&e[b]===a?null:b,b=!1),null!=d&&(d=c.createCallback(d,e,3)),eb(a,b,d)}function Dc(a){return $(a,n(arguments,1))}function Ec(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Zd(c)||mb(c))var d=d?eb($(d,c).concat($(c,d))):c}return d||[]}function Fc(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?ac(me(a,"length")):0,d=nd(0>c?0:c);++b<c;)d[b]=me(a,b);return d}function Gc(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Zd(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Hc(a,b){if(!Db(b))throw new wd;return function(){return--a<1?b.apply(this,arguments):void 0}}function Ic(a,b){return arguments.length>2?gb(a,17,n(arguments,2),null,b):gb(a,1,null,null,b)}function Jc(a){for(var b=arguments.length>1?_(arguments,!0,!1,1):ub(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=gb(a[e],1,null,null,a)}return a}function Kc(a,b){return arguments.length>2?gb(b,19,n(arguments,2),null,a):gb(b,3,null,null,a)}function Lc(){for(var a=arguments,b=a.length;b--;)if(!Db(a[b]))throw new wd;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Mc(a,b){return b="number"==typeof b?b:+b||a.length,gb(a,4,null,null,null,b)}function Nc(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!Db(a))throw new wd;if(b=Sd(0,b)||0,c===!0){var n=!0;m=!1}else Eb(c)&&(n=c.leading,l="maxWait"in c&&(Sd(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(oe()-g);if(0>=c){e&&Dd(e);var l=j;e=i=j=p,l&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))}else i=Jd(o,c)},q=function(){i&&Dd(i),e=i=j=p,(m||l!==b)&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=oe(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var p=l-(g-k),r=0>=p;r?(e&&(e=Dd(e)),k=g,f=a.apply(h,d)):e||(e=Jd(q,p))}return r&&i?i=Dd(i):i||b===l||(i=Jd(o,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Oc(a){if(!Db(a))throw new wd;var b=n(arguments,1);return Jd(function(){a.apply(p,b)},1)}function Pc(a,b){if(!Db(a))throw new wd;var c=n(arguments,2);return Jd(function(){a.apply(p,c)},b)}function Qc(a,b){if(!Db(a))throw new wd;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):t+arguments[0];return Hd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Rc(a){var b,c;if(!Db(a))throw new wd;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Sc(a){return gb(a,16,n(arguments,1))}function Tc(a){return gb(a,32,null,n(arguments,1))}function Uc(a,b,c){var d=!0,e=!0;if(!Db(a))throw new wd;return c===!1?d=!1:Eb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),U.leading=d,U.maxWait=b,U.trailing=e,Nc(a,b,U)}function Vc(a,b){return gb(b,16,[a])}function Wc(a){return function(){return a}}function Xc(a,b,c){var d=typeof a;if(null==a||"function"==d)return X(a,b,c);if("object"!=d)return bd(a);var e=_d(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Eb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=ab(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Yc(a){return null==a?"":vd(a).replace(de,hb)}function Zc(a){return a}function $c(a,b,d){var f=!0,g=b&&ub(b);b&&(d||g.length)||(null==d&&(d=b),h=e,b=a,a=c,g=ub(b)),d===!1?f=!1:Eb(d)&&"chain"in d&&(f=d.chain);var h=a,i=Db(h);Yb(g,function(c){var d=a[c]=b[c];i&&(h.prototype[c]=function(){var b=this.__chain__,c=this.__wrapped__,e=[c];Id.apply(e,arguments);var g=d.apply(a,e);if(f||b){if(c===g&&Eb(g))return this;g=new h(g),g.__chain__=b}return g})})}function _c(){return a._=zd,this}function ad(){}function bd(a){return function(b){return b[a]}}function cd(a,b,c){var d=null==a,e=null==b;if(null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=Vd();return Td(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b)}return db(a,b)}function dd(a,b){if(a){var c=a[b];return Db(c)?a[b]():c}}function ed(a,b,d){var e=c.templateSettings;a=vd(a||""),d=fe({},d,e);var f,g=fe({},d.imports,e.imports),h=_d(g),j=Rb(g),k=0,l=d.interpolate||F,m="__p += '",n=ud((d.escape||F).source+"|"+l.source+"|"+(l===D?A:F).source+"|"+(d.evaluate||F).source+"|$","g");a.replace(n,function(b,c,d,e,g,h){return d||(d=e),m+=a.slice(k,h).replace(H,i),c&&(m+="' +\n__e("+c+") +\n'"),g&&(f=!0,m+="';\n"+g+";\n__p += '"),d&&(m+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),k=h+b.length,b}),m+="';\n";var o=d.variable,q=o;q||(o="obj",m="with ("+o+") {\n"+m+"\n}\n"),m=(f?m.replace(x,""):m).replace(y,"$1").replace(z,"$1;"),m="function("+o+") {\n"+(q?"":o+" || ("+o+" = {});\n")+"var __t, __p = '', __e = _.escape"+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var r="\n/*\n//# sourceURL="+(d.sourceURL||"/lodash/template/source["+J++ +"]")+"\n*/";try{var s=qd(h,"return "+m+r).apply(p,j)}catch(t){throw t.source=m,t}return b?s(b):(s.source=m,s)}function fd(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=nd(a);for(b=X(b,c,1);++d<a;)e[d]=b(d);return e}function gd(a){return null==a?"":vd(a).replace(ce,lb)}function hd(a){var b=++s;return vd(null==a?"":a)+b}function id(a){return a=new e(a),a.__chain__=!0,a}function jd(a,b){return b(a),a}function kd(){return this.__chain__=!0,this}function ld(){return vd(this.__wrapped__)}function md(){return this.__wrapped__}a=a?bb.defaults(Y.Object(),a,bb.pick(Y,I)):Y;var nd=a.Array,od=a.Boolean,pd=a.Date,qd=a.Function,rd=a.Math,sd=a.Number,td=a.Object,ud=a.RegExp,vd=a.String,wd=a.TypeError,xd=[],yd=td.prototype,zd=a._,Ad=yd.toString,Bd=ud("^"+vd(Ad).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cd=rd.ceil,Dd=a.clearTimeout,Ed=rd.floor,Fd=qd.prototype.toString,Gd=jb(Gd=td.getPrototypeOf)&&Gd,Hd=yd.hasOwnProperty,Id=xd.push,Jd=a.setTimeout,Kd=xd.splice,Ld=xd.unshift,Md=function(){try{var a={},b=jb(b=td.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Nd=jb(Nd=td.create)&&Nd,Od=jb(Od=nd.isArray)&&Od,Pd=a.isFinite,Qd=a.isNaN,Rd=jb(Rd=td.keys)&&Rd,Sd=rd.max,Td=rd.min,Ud=a.parseInt,Vd=rd.random,Wd={};Wd[L]=nd,Wd[M]=od,Wd[N]=pd,Wd[O]=qd,Wd[Q]=td,Wd[P]=sd,Wd[R]=ud,Wd[S]=vd,e.prototype=c.prototype;var Xd=c.support={};Xd.funcDecomp=!jb(a.WinRTError)&&G.test(o),Xd.funcNames="string"==typeof qd.name,c.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:D,variable:"",imports:{_:c}},Nd||(v=function(){function b(){}return function(c){if(Eb(c)){b.prototype=c;var d=new b;b.prototype=null}return d||a.Object()}}());var Yd=Md?function(a,b){V.value=b,Md(a,"__bindData__",V)}:ad,Zd=Od||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==L||!1},$d=function(a){var b,c=a,d=[];if(!c)return d;if(!W[typeof a])return d;for(b in c)Hd.call(c,b)&&d.push(b);return d},_d=Rd?function(a){return Eb(a)?Rd(a):[]}:$d,ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},be=wb(ae),ce=ud("("+_d(be).join("|")+")","g"),de=ud("["+_d(ae).join("")+"]","g"),ee=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=X(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&W[typeof e])for(var k=-1,l=W[typeof e]&&_d(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},fe=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&W[typeof e])for(var j=-1,k=W[typeof e]&&_d(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},ge=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!W[typeof e])return f;b=b&&"undefined"==typeof c?b:X(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},he=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!W[typeof e])return f;b=b&&"undefined"==typeof c?b:X(b,c,3);for(var g=-1,h=W[typeof e]&&_d(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},ie=Gd?function(a){if(!a||Ad.call(a)!=Q)return!1;var b=a.valueOf,c=jb(b)&&(c=Gd(b))&&Gd(c);return c?a==c||Gd(a)==c:kb(a)}:kb,je=fb(function(a,b,c){Hd.call(a,c)?a[c]++:a[c]=1}),ke=fb(function(a,b,c){(Hd.call(a,c)?a[c]:a[c]=[]).push(b)}),le=fb(function(a,b,c){a[c]=b}),me=_b,ne=Vb,oe=jb(oe=pd.now)&&oe||function(){return(new pd).getTime()},pe=8==Ud(w+"08")?Ud:function(a,b){return Ud(Jb(a)?a.replace(E,""):a,b||0)};return c.after=Hc,c.assign=ee,c.at=Sb,c.bind=Ic,c.bindAll=Jc,c.bindKey=Kc,c.chain=id,c.compact=lc,c.compose=Lc,c.constant=Wc,c.countBy=je,c.create=pb,c.createCallback=Xc,c.curry=Mc,c.debounce=Nc,c.defaults=fe,c.defer=Oc,c.delay=Pc,c.difference=mc,c.filter=Vb,c.flatten=qc,c.forEach=Yb,c.forEachRight=Zb,c.forIn=ge,c.forInRight=sb,c.forOwn=he,c.forOwnRight=tb,c.functions=ub,c.groupBy=ke,c.indexBy=le,c.initial=sc,c.intersection=tc,c.invert=wb,c.invoke=$b,c.keys=_d,c.map=_b,c.mapValues=Lb,c.max=ac,c.memoize=Qc,c.merge=Mb,c.min=bc,c.omit=Nb,c.once=Rc,c.pairs=Ob,c.partial=Sc,c.partialRight=Tc,c.pick=Pb,c.pluck=me,c.property=bd,c.pull=wc,c.range=xc,c.reject=ec,c.remove=yc,c.rest=zc,c.shuffle=gc,c.sortBy=jc,c.tap=jd,c.throttle=Uc,c.times=fd,c.toArray=kc,c.transform=Qb,c.union=Bc,c.uniq=Cc,c.values=Rb,c.where=ne,c.without=Dc,c.wrap=Vc,c.xor=Ec,c.zip=Fc,c.zipObject=Gc,c.collect=_b,c.drop=zc,c.each=Yb,c.eachRight=Zb,c.extend=ee,c.methods=ub,c.object=Gc,c.select=Vb,c.tail=zc,c.unique=Cc,c.unzip=Fc,$c(c),c.clone=nb,c.cloneDeep=ob,c.contains=Tb,c.escape=Yc,c.every=Ub,c.find=Wb,c.findIndex=nc,c.findKey=qb,c.findLast=Xb,c.findLastIndex=oc,c.findLastKey=rb,c.has=vb,c.identity=Zc,c.indexOf=rc,c.isArguments=mb,c.isArray=Zd,c.isBoolean=xb,c.isDate=yb,c.isElement=zb,c.isEmpty=Ab,c.isEqual=Bb,c.isFinite=Cb,c.isFunction=Db,c.isNaN=Fb,c.isNull=Gb,c.isNumber=Hb,c.isObject=Eb,c.isPlainObject=ie,c.isRegExp=Ib,c.isString=Jb,c.isUndefined=Kb,c.lastIndexOf=vc,c.mixin=$c,c.noConflict=_c,c.noop=ad,c.now=oe,c.parseInt=pe,c.random=cd,c.reduce=cc,c.reduceRight=dc,c.result=dd,c.runInContext=o,c.size=hc,c.some=ic,c.sortedIndex=Ac,c.template=ed,c.unescape=gd,c.uniqueId=hd,c.all=Ub,c.any=ic,c.detect=Wb,c.findWhere=Wb,c.foldl=cc,c.foldr=dc,c.include=Tb,c.inject=cc,$c(function(){var a={};
return he(c,function(b,d){c.prototype[d]||(a[d]=b)}),a}(),!1),c.first=pc,c.last=uc,c.sample=fc,c.take=pc,c.head=pc,he(c,function(a,b){var d="sample"!==b;c.prototype[b]||(c.prototype[b]=function(b,c){var f=this.__chain__,g=a(this.__wrapped__,b,c);return f||null!=b&&(!c||d&&"function"==typeof b)?new e(g,f):g})}),c.VERSION="2.4.1",c.prototype.chain=kd,c.prototype.toString=ld,c.prototype.value=md,c.prototype.valueOf=md,Yb(["join","pop","shift"],function(a){var b=xd[a];c.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new e(c,a):c}}),Yb(["push","reverse","sort","unshift"],function(a){var b=xd[a];c.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Yb(["concat","slice","splice"],function(a){var b=xd[a];c.prototype[a]=function(){return new e(b.apply(this.__wrapped__,arguments),this.__chain__)}}),c}var p,q=[],r=[],s=0,t=+new Date+"",u=75,v=40,w="  \f ﻿\n\r\u2028\u2029 ᠎             　",x=/\b__p \+= '';/g,y=/\b(__p \+=) '' \+/g,z=/(__e\(.*?\)|\b__t\)) \+\n'';/g,A=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,B=/\w*$/,C=/^\s*function[ \n\r\t]+\w/,D=/<%=([\s\S]+?)%>/g,E=RegExp("^["+w+"]*0+(?=.$)"),F=/($^)/,G=/\bthis\b/,H=/['\n\r\t\u2028\u2029\\]/g,I=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],J=0,K="[object Arguments]",L="[object Array]",M="[object Boolean]",N="[object Date]",O="[object Function]",P="[object Number]",Q="[object Object]",R="[object RegExp]",S="[object String]",T={};T[O]=!1,T[K]=T[L]=T[M]=T[N]=T[P]=T[Q]=T[R]=T[S]=!0;var U={leading:!1,maxWait:0,trailing:!1},V={configurable:!1,enumerable:!1,value:null,writable:!1},W={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},X={"\\":"\\","'":"'","\n":"n","\r":"r"," ":"t","\u2028":"u2028","\u2029":"u2029"},Y=W[typeof a]&&a||this,Z=W[typeof exports]&&exports&&!exports.nodeType&&exports,$=W[typeof module]&&module&&!module.nodeType&&module,_=$&&$.exports===Z&&Z,ab=W[typeof c]&&c;!ab||ab.global!==ab&&ab.window!==ab||(Y=ab);var bb=o();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Y._=bb,define(function(){return bb})):Z&&$?_?($.exports=bb)._=bb:Z._=bb:Y._=bb}.call(this),!function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,f,g,h,i,j;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(b.length),g=new Uint8Array(f),h=0;h<b.length;h+=1)g[h]=b.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],c?new Blob([d?g:f],{type:i}):(j=new e,j.append(f),j.getBlob(i))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){a(d&&b.toDataURL&&f?f(this.toDataURL(c,d)):this.mozGetAsFile("blob",c))}:b.toDataURL&&f&&(b.toBlob=function(a,b,c){a(f(this.toDataURL(b,c)))})),"function"==typeof define&&define.amd?define(function(){return f}):a.dataURLtoBlob=f}(this),function(a){"use strict";function b(){this.data={}}function c(){this.listeners=new b}function d(a){setTimeout(function(){throw a},0)}function e(a){this.type=a,this.target=null}function f(a,b){e.call(this,a),this.data=b.data,this.lastEventId=b.lastEventId}function g(a,b){var c=Number(a)||b;return z>c?z:c>A?A:c}function h(a,b,c){try{"function"==typeof b&&b.call(a,c)}catch(e){d(e)}}function i(b,d){function i(){L=s,null!==H&&(H.abort(),H=null),0!==I&&(clearTimeout(I),I=0),0!==J&&(clearTimeout(J),J=0),E.readyState=s}function j(a){var b=L===r||L===q?H.responseText||"":"",c=null,d=!1;if(L===q){var i=0,j="",k="";if(n)try{i=Number(H.status||0),j=String(H.statusText||""),k=String(H.getResponseHeader("Content-Type")||"")}catch(l){i=0}else i=200,k=H.contentType;if(200===i&&y.test(k)){if(L=r,G=!0,F=B,E.readyState=r,c=new e("open"),E.dispatchEvent(c),h(E,E.onopen,c),L===s)return}else if(0!==i){var m="";m=200!==i?"EventSource's response has a status "+i+" "+j.replace(/\s+/g," ")+" that is not 200. Aborting the connection.":"EventSource's response has a Content-Type specifying an unsupported type: "+k.replace(/\s+/g," ")+". Aborting the connection.",setTimeout(function(){throw new Error(m)}),d=!0}}if(L===r){b.length>K&&(G=!0);for(var o=K-1,z=b.length,J="\n";++o<z;)if(J=b[o],Q===t&&"\n"===J)Q=u;else if(Q===t&&(Q=u),"\r"===J||"\n"===J){if("data"===R?M.push(S):"id"===R?N=S:"event"===R?O=S:"retry"===R?(B=g(S,B),F=B):"heartbeatTimeout"===R&&(C=g(S,C),0!==I&&(clearTimeout(I),I=setTimeout(P,C))),S="",R="",Q===u){if(0!==M.length&&(D=N,""===O&&(O="message"),c=new f(O,{data:M.join("\n"),lastEventId:N}),E.dispatchEvent(c),"message"===O&&h(E,E.onmessage,c),L===s))return;M.length=0,O=""}Q="\r"===J?t:u}else Q===u&&(Q=v),Q===v?":"===J?Q=w:R+=J:Q===w?(" "!==J&&(S+=J),Q=x):Q===x&&(S+=J);K=z}L!==r&&L!==q||!(a||d||K>1048576||0===I&&!G)?0===I&&(G=!1,I=setTimeout(P,C)):(L=p,H.abort(),0!==I&&(clearTimeout(I),I=0),F>16*B&&(F=16*B),F>A&&(F=A),I=setTimeout(P,F),F=2*F+1,E.readyState=q,c=new e("error"),E.dispatchEvent(c),h(E,E.onerror,c))}function k(){j(!1)}function l(){j(!0)}b=String(b);var z=Boolean(m&&d&&d.withCredentials),B=g(d?d.retry:0/0,1e3),C=g(d?d.heartbeatTimeout:0/0,45e3),D=d&&d.lastEventId&&String(d.lastEventId)||"",E=this,F=B,G=!1,H=new o,I=0,J=0,K=0,L=p,M=[],N="",O="",P=null,Q=u,R="",S="";d=null,n&&(J=setTimeout(function T(){3===H.readyState&&k(),J=setTimeout(T,500)},0)),P=function(){if(I=0,L!==p)return void j(!1);if(n&&(void 0!==H.sendAsBinary||void 0===H.onloadend)&&a.document&&a.document.readyState&&"complete"!==a.document.readyState)return void(I=setTimeout(P,4));H.onload=H.onerror=l,n&&(H.onabort=l,H.onreadystatechange=k),H.onprogress=k,G=!1,I=setTimeout(P,C),K=0,L=q,M.length=0,O="",N=D,S="",R="",Q=u;var c=b.slice(0,5);c="data:"!==c&&"blob:"!==c?b+((-1===b.indexOf("?",0)?"?":"&")+"lastEventId="+encodeURIComponent(D)+"&r="+String(Math.random()+1).slice(2)):b,H.open("GET",c,!0),n&&(H.withCredentials=z,H.responseType="text",H.setRequestHeader("Accept","text/event-stream")),H.send(null)},c.call(this),this.close=i,this.url=b,this.readyState=q,this.withCredentials=z,this.onopen=null,this.onmessage=null,this.onerror=null,P()}function j(){this.CONNECTING=q,this.OPEN=r,this.CLOSED=s}b.prototype={get:function(a){return this.data[a+"~"]},set:function(a,b){this.data[a+"~"]=b},"delete":function(a){delete this.data[a+"~"]}},c.prototype={dispatchEvent:function(a){a.target=this;var b=String(a.type),c=this.listeners,e=c.get(b);if(e)for(var f=e.length,g=-1,h=null;++g<f;){h=e[g];try{h.call(this,a)}catch(i){d(i)}}},addEventListener:function(a,b){a=String(a);var c=this.listeners,d=c.get(a);d||(d=[],c.set(a,d));for(var e=d.length;--e>=0;)if(d[e]===b)return;d.push(b)},removeEventListener:function(a,b){a=String(a);var c=this.listeners,d=c.get(a);if(d){for(var e=d.length,f=[],g=-1;++g<e;)d[g]!==b&&f.push(d[g]);0===f.length?c["delete"](a):c.set(a,f)}}},f.prototype=e.prototype;var k=a.XMLHttpRequest,l=a.XDomainRequest,m=Boolean(k&&void 0!==(new k).withCredentials),n=m,o=m?k:l,p=-1,q=0,r=1,s=2,t=3,u=4,v=5,w=6,x=7,y=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,z=1e3,A=18e6;j.prototype=c.prototype,i.prototype=new j,j.call(i),o&&(a.NativeEventSource=a.EventSource,a.EventSource=i)}(this);var b="?.?.?",c=this;!function(a,b){"function"==typeof define&&define.amd?define(["when"],function(c){return a.ab=b(a,c)}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=b(a,a.when)):a.ab=b(a,a.when)}(c,function(a,c){"use strict";var d={};return d._version=b,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=new Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=new Object(this),f=e.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}})}(),d._sliceUserAgent=function(a,b,c){var d=[],e=navigator.userAgent,f=e.indexOf(a),g=e.indexOf(b,f);0>g&&(g=e.length);for(var h=e.slice(f,g).split(c),i=h[1].split("."),j=0;j<i.length;++j)d.push(parseInt(i[j],10));return{name:h[0],version:d}},d.getBrowser=function(){var a=navigator.userAgent;return a.indexOf("Chrome")>-1?d._sliceUserAgent("Chrome"," ","/"):a.indexOf("Safari")>-1?d._sliceUserAgent("Safari"," ","/"):a.indexOf("Firefox")>-1?d._sliceUserAgent("Firefox"," ","/"):a.indexOf("MSIE")>-1?d._sliceUserAgent("MSIE",";"," "):null},d.getServerUrl=function(b,c){if("file:"===a.location.protocol)return c?c:"ws://127.0.0.1/ws";var d="https:"===a.location.protocol?"wss://":"ws://",e=""!==a.location.port?":"+a.location.port:"",f=b?b:"ws";return d+a.location.hostname+e+"/"+f},d.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)",d.deriveKey=function(a,b){if(b&&b.salt){var c=b.salt,d=b.keylen||32,e=b.iterations||1e4,f=CryptoJS.PBKDF2(a,c,{keySize:d/4,iterations:e,hasher:CryptoJS.algo.SHA256});return f.toString(CryptoJS.enc.Base64)}return a},d._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d._idlen=16,d._subprotocol="wamp",d._newid=function(){for(var a="",b=0;b<d._idlen;b+=1)a+=d._idchars.charAt(Math.floor(Math.random()*d._idchars.length));return a},d._newidFast=function(){return Math.random().toString(36)},d.log=function(){if(arguments.length>1){console.group("Log Item");for(var a=0;a<arguments.length;a+=1)console.log(arguments[a]);console.groupEnd()}else console.log(arguments[0])},d._debugrpc=!1,d._debugpubsub=!1,d._debugws=!1,d._debugconnect=!1,d.debug=function(b,c,e){if(!("console"in a))throw"browser does not support console object";d._debugrpc=b,d._debugpubsub=b,d._debugws=c,d._debugconnect=e},d.version=function(){return d._version},d.PrefixMap=function(){var a=this;a._index={},a._rindex={}},d.PrefixMap.prototype.get=function(a){var b=this;return b._index[a]},d.PrefixMap.prototype.set=function(a,b){var c=this;c._index[a]=b,c._rindex[b]=a},d.PrefixMap.prototype.setDefault=function(a){var b=this;b._index[""]=a,b._rindex[a]=""},d.PrefixMap.prototype.remove=function(a){var b=this,c=b._index[a];c&&(delete b._index[a],delete b._rindex[c])},d.PrefixMap.prototype.resolve=function(a,b){var c=this,d=a.indexOf(":");if(d>=0){var e=a.substring(0,d);if(c._index[e])return c._index[e]+a.substring(d+1)}return b===!0?a:null},d.PrefixMap.prototype.shrink=function(a,b){for(var c=this,d=a.length;d>0;d-=1){var e=a.substring(0,d),f=c._rindex[e];if(f)return f+":"+a.substring(d)}return b===!0?a:null},d._MESSAGE_TYPEID_WELCOME=0,d._MESSAGE_TYPEID_PREFIX=1,d._MESSAGE_TYPEID_CALL=2,d._MESSAGE_TYPEID_CALL_RESULT=3,d._MESSAGE_TYPEID_CALL_ERROR=4,d._MESSAGE_TYPEID_SUBSCRIBE=5,d._MESSAGE_TYPEID_UNSUBSCRIBE=6,d._MESSAGE_TYPEID_PUBLISH=7,d._MESSAGE_TYPEID_EVENT=8,d.CONNECTION_CLOSED=0,d.CONNECTION_LOST=1,d.CONNECTION_RETRIES_EXCEEDED=2,d.CONNECTION_UNREACHABLE=3,d.CONNECTION_UNSUPPORTED=4,d.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5,d.CONNECTION_LOST_SCHEDULED_RECONNECT=6,d.Deferred=c.defer,d._construct=function(b,c){return"WebSocket"in a?c?new WebSocket(b,c):new WebSocket(b):"MozWebSocket"in a?c?new MozWebSocket(b,c):new MozWebSocket(b):null},d.Session=function(a,b,c,e){var f=this;if(f._wsuri=a,f._options=e,f._websocket_onopen=b,f._websocket_onclose=c,f._websocket=null,f._websocket_connected=!1,f._session_id=null,f._wamp_version=null,f._server=null,f._calls={},f._subscriptions={},f._prefixes=new d.PrefixMap,f._txcnt=0,f._rxcnt=0,f._websocket=f._options&&f._options.skipSubprotocolAnnounce?d._construct(f._wsuri):d._construct(f._wsuri,[d._subprotocol]),!f._websocket){if(void 0!==c)return void c(d.CONNECTION_UNSUPPORTED);throw d.browserNotSupportedMessage}f._websocket.onmessage=function(a){d._debugws&&(f._rxcnt+=1,console.group("WS Receive"),console.info(f._wsuri+"  ["+f._session_id+"]"),console.log(f._rxcnt),console.log(a.data),console.groupEnd());var b=JSON.parse(a.data);if(b[1]in f._calls){if(b[0]===d._MESSAGE_TYPEID_CALL_RESULT){var c=f._calls[b[1]],e=b[2];if(d._debugrpc&&void 0!==c._ab_callobj){console.group("WAMP Call",c._ab_callobj[2]),console.timeEnd(c._ab_tid),console.group("Arguments");for(var g=3;g<c._ab_callobj.length;g+=1){var h=c._ab_callobj[g];if(void 0===h)break;console.log(h)}console.groupEnd(),console.group("Result"),console.log(e),console.groupEnd(),console.groupEnd()}c.resolve(e)}else if(b[0]===d._MESSAGE_TYPEID_CALL_ERROR){var i=f._calls[b[1]],j=b[2],k=b[3],l=b[4];if(d._debugrpc&&void 0!==i._ab_callobj){console.group("WAMP Call",i._ab_callobj[2]),console.timeEnd(i._ab_tid),console.group("Arguments");for(var m=3;m<i._ab_callobj.length;m+=1){var n=i._ab_callobj[m];if(void 0===n)break;console.log(n)}console.groupEnd(),console.group("Error"),console.log(j),console.log(k),void 0!==l&&console.log(l),console.groupEnd(),console.groupEnd()}i.reject(void 0!==l?{uri:j,desc:k,detail:l}:{uri:j,desc:k})}delete f._calls[b[1]]}else if(b[0]===d._MESSAGE_TYPEID_EVENT){var o=f._prefixes.resolve(b[1],!0);if(o in f._subscriptions){var p=b[1],q=b[2];d._debugpubsub&&(console.group("WAMP Event"),console.info(f._wsuri+"  ["+f._session_id+"]"),console.log(p),console.log(q),console.groupEnd()),f._subscriptions[o].forEach(function(a){a(p,q)})}}else if(b[0]===d._MESSAGE_TYPEID_WELCOME){if(null!==f._session_id)throw"protocol error (welcome message received more than once)";f._session_id=b[1],f._wamp_version=b[2],f._server=b[3],(d._debugrpc||d._debugpubsub)&&(console.group("WAMP Welcome"),console.info(f._wsuri+"  ["+f._session_id+"]"),console.log(f._wamp_version),console.log(f._server),console.groupEnd()),null!==f._websocket_onopen&&f._websocket_onopen()}},f._websocket.onopen=function(){if(f._websocket.protocol!==d._subprotocol)if("undefined"==typeof f._websocket.protocol)d._debugws&&(console.group("WS Warning"),console.info(f._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else{if(!f._options||!f._options.skipSubprotocolCheck)throw f._websocket.close(1e3,"server does not speak WAMP"),"server does not speak WAMP (but '"+f._websocket.protocol+"' !)";d._debugws&&(console.group("WS Warning"),console.info(f._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(f._websocket.protocol),console.groupEnd())}d._debugws&&(console.group("WAMP Connect"),console.info(f._wsuri),console.log(f._websocket.protocol),console.groupEnd()),f._websocket_connected=!0},f._websocket.onerror=function(){},f._websocket.onclose=function(a){d._debugws&&console.log(f._websocket_connected?"Autobahn connection to "+f._wsuri+" lost (code "+a.code+", reason '"+a.reason+"', wasClean "+a.wasClean+").":"Autobahn could not connect to "+f._wsuri+" (code "+a.code+", reason '"+a.reason+"', wasClean "+a.wasClean+")."),void 0!==f._websocket_onclose&&(f._websocket_connected?a.wasClean?f._websocket_onclose(d.CONNECTION_CLOSED,"WS-"+a.code+": "+a.reason):f._websocket_onclose(d.CONNECTION_LOST):f._websocket_onclose(d.CONNECTION_UNREACHABLE)),f._websocket_connected=!1,f._wsuri=null,f._websocket_onopen=null,f._websocket_onclose=null,f._websocket=null},f.log=function(){console.group(f._options&&"sessionIdent"in f._options?"WAMP Session '"+f._options.sessionIdent+"' ["+f._session_id+"]":"WAMP Session ["+f._session_id+"]");for(var a=0;a<arguments.length;++a)console.log(arguments[a]);console.groupEnd()}},d.Session.prototype._send=function(b){var c=this;if(!c._websocket_connected)throw"Autobahn not connected";var e;switch(!0){case a.Prototype&&"undefined"==typeof top.root.__prototype_deleted:case"function"==typeof b.toJSON:e=b.toJSON();break;default:e=JSON.stringify(b)}c._websocket.send(e),c._txcnt+=1,d._debugws&&(console.group("WS Send"),console.info(c._wsuri+"  ["+c._session_id+"]"),console.log(c._txcnt),console.log(e),console.groupEnd())},d.Session.prototype.close=function(){var a=this;a._websocket_connected&&a._websocket.close()},d.Session.prototype.sessionid=function(){var a=this;return a._session_id},d.Session.prototype.wsuri=function(){var a=this;return a._wsuri},d.Session.prototype.shrink=function(a,b){var c=this;return void 0===b&&(b=!0),c._prefixes.shrink(a,b)},d.Session.prototype.resolve=function(a,b){var c=this;return void 0===b&&(b=!0),c._prefixes.resolve(a,b)},d.Session.prototype.prefix=function(a,b){var c=this;c._prefixes.set(a,b),(d._debugrpc||d._debugpubsub)&&(console.group("WAMP Prefix"),console.info(c._wsuri+"  ["+c._session_id+"]"),console.log(a),console.log(b),console.groupEnd());var e=[d._MESSAGE_TYPEID_PREFIX,a,b];c._send(e)},d.Session.prototype.call=function(){for(var a,b=this,c=new d.Deferred;;)if(a=d._newidFast(),!(a in b._calls))break;b._calls[a]=c;for(var e=b._prefixes.shrink(arguments[0],!0),f=[d._MESSAGE_TYPEID_CALL,a,e],g=1;g<arguments.length;g+=1)f.push(arguments[g]);return b._send(f),d._debugrpc&&(c._ab_callobj=f,c._ab_tid=b._wsuri+"  ["+b._session_id+"]["+a+"]",console.time(c._ab_tid),console.info()),c.promise.then?c.promise:c},d.Session.prototype.subscribe=function(a,b){var c=this,e=c._prefixes.resolve(a,!0);if(!(e in c._subscriptions)){d._debugpubsub&&(console.group("WAMP Subscribe"),console.info(c._wsuri+"  ["+c._session_id+"]"),console.log(a),console.log(b),console.groupEnd());var f=[d._MESSAGE_TYPEID_SUBSCRIBE,a];c._send(f),c._subscriptions[e]=[]}var g=c._subscriptions[e].indexOf(b);if(-1!==g)throw"callback "+b+" already subscribed for topic "+e;c._subscriptions[e].push(b)},d.Session.prototype.unsubscribe=function(a,b){var c=this,e=c._prefixes.resolve(a,!0);if(!(e in c._subscriptions))throw"not subscribed to topic "+e;var f;if(void 0!==b){var g=c._subscriptions[e].indexOf(b);if(-1===g)throw"no callback "+b+" subscribed on topic "+e;f=b,c._subscriptions[e].splice(g,1)}else f=c._subscriptions[e].slice(),c._subscriptions[e]=[];if(0===c._subscriptions[e].length){delete c._subscriptions[e],d._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(c._wsuri+"  ["+c._session_id+"]"),console.log(a),console.log(f),console.groupEnd());var h=[d._MESSAGE_TYPEID_UNSUBSCRIBE,a];c._send(h)}},d.Session.prototype.publish=function(){var a=this,b=arguments[0],c=arguments[1],e=null,f=null,g=null,h=null;if(arguments.length>3){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";f=arguments[2],g=arguments[3],h=[d._MESSAGE_TYPEID_PUBLISH,b,c,f,g]}else if(arguments.length>2)if("boolean"==typeof arguments[2])e=arguments[2],h=[d._MESSAGE_TYPEID_PUBLISH,b,c,e];else{if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";f=arguments[2],h=[d._MESSAGE_TYPEID_PUBLISH,b,c,f]}else h=[d._MESSAGE_TYPEID_PUBLISH,b,c];d._debugpubsub&&(console.group("WAMP Publish"),console.info(a._wsuri+"  ["+a._session_id+"]"),console.log(b),console.log(c),null!==e?console.log(e):null!==f&&(console.log(f),null!==g&&console.log(g)),console.groupEnd()),a._send(h)},d.Session.prototype.authreq=function(a,b){return this.call("http://api.wamp.ws/procedure#authreq",a,b)},d.Session.prototype.authsign=function(a,b){return b||(b=""),CryptoJS.HmacSHA256(a,b).toString(CryptoJS.enc.Base64)},d.Session.prototype.auth=function(a){return this.call("http://api.wamp.ws/procedure#auth",a)},d._connect=function(b){var c=new d.Session(b.wsuri,function(){b.connects+=1,b.retryCount=0,b.onConnect(c)},function(c,e){var f=null;switch(c){case d.CONNECTION_CLOSED:b.onHangup(c,"Connection was closed properly ["+e+"]");break;case d.CONNECTION_UNSUPPORTED:b.onHangup(c,"Browser does not support WebSocket.");break;case d.CONNECTION_UNREACHABLE:b.retryCount+=1,0===b.connects?b.onHangup(c,"Connection could not be established."):b.retryCount<=b.options.maxRetries?(f=b.onHangup(d.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+b.options.retryDelay/1e3+" second(s) - attempt "+b.retryCount+" of "+b.options.maxRetries+".",{delay:b.options.retryDelay,retries:b.retryCount,maxretries:b.options.maxRetries}),f?(d._debugconnect&&console.log("Connection unreachable - retrying stopped by app"),b.onHangup(d.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")):(d._debugconnect&&console.log("Connection unreachable - retrying ("+b.retryCount+") .."),a.setTimeout(function(){d._connect(b)},b.options.retryDelay))):b.onHangup(d.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.");break;case d.CONNECTION_LOST:b.retryCount+=1,b.retryCount<=b.options.maxRetries?(f=b.onHangup(d.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled "+b.retryCount+"th reconnect to occur in "+b.options.retryDelay/1e3+" second(s).",{delay:b.options.retryDelay,retries:b.retryCount,maxretries:b.options.maxRetries}),f?(d._debugconnect&&console.log("Connection lost - retrying stopped by app"),b.onHangup(d.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")):(d._debugconnect&&console.log("Connection lost - retrying ("+b.retryCount+") .."),a.setTimeout(function(){d._connect(b)},b.options.retryDelay))):b.onHangup(d.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect"}},b.options)},d.connect=function(a,b,c,e){var f={};if(f.wsuri=a,f.options=e?e:{},void 0===f.options.retryDelay&&(f.options.retryDelay=5e3),void 0===f.options.maxRetries&&(f.options.maxRetries=10),void 0===f.options.skipSubprotocolCheck&&(f.options.skipSubprotocolCheck=!1),void 0===f.options.skipSubprotocolAnnounce&&(f.options.skipSubprotocolAnnounce=!1),!b)throw"onConnect handler required!";f.onConnect=b,f.onHangup=c?c:function(a,b,c){d._debugconnect&&console.log(a,b,c)},f.connects=0,f.retryCount=0,d._connect(f)},d.launch=function(a,b,c){d.connect(a.wsuri,function(c){a.appkey&&""!==a.appkey?c.authreq(a.appkey,a.appextra).then(function(e){var f=null;if("function"==typeof a.appsecret)f=a.appsecret(e);else{var g=d.deriveKey(a.appsecret,JSON.parse(e).authextra);f=c.authsign(e,g)}c.auth(f).then(function(){b?b(c):d._debugconnect&&c.log("Session opened.")},c.log)},c.log):c.authreq().then(function(){c.auth().then(function(){b?b(c):d._debugconnect&&c.log("Session opened.")},c.log)},c.log)},function(a,b,e){c?c(a,b,e):d._debugconnect&&d.log("Session closed.",a,b,e)},a.sessionConfig)},d});var d={VERSION:"0.1.0",defaults:{perPage:50}};a.DL=d,"undefined"==typeof a.FormData&&(a.FormData=function(){this.append=function(){}}),d.Client=function(a){this.url=a.url||"http://dl-api.dev/api/public/index.php/",this.appId=a.appId,this.key=a.key,this.proxy=a.proxy,this.url.lastIndexOf("/")!=this.url.length-1&&(this.url+="/"),this.keys=new d.KeyValues(this),this.auth=new d.Auth(this),this.files=new d.Files(this),this.system=new d.System(this),d.Plugin.Manager.setup(this)},d.Client.prototype.collection=function(a){return new d.Collection(this,a)},d.Client.prototype.channel=function(a,b){"undefined"==typeof b&&(b={});var c=this.collection(a);return c.segments=c.segments.replace("collection/","channels/"),b.transport||(b.transport="sse"),b.transport=b.transport.toUpperCase(),new d.Channel[b.transport](this,c,b)},d.Client.prototype.post=function(a,b){return"undefined"==typeof b&&(b={}),this.request(a,"POST",b)},d.Client.prototype.get=function(a,b){return this.request(a,"GET",b)},d.Client.prototype.put=function(a,b){return this.request(a,"PUT",b)},d.Client.prototype.remove=function(a,b){return this.request(a,"DELETE",b)},d.Client.prototype.request=function(a,b,c){var d,e,f=when.defer(),g=!1;if(c&&c._sync&&(delete c._sync,g=!0),d=this.getPayload(b,c),e=this.getHeaders(),d instanceof FormData||(e["Content-Type"]="application/json"),this.proxy)e["X-Endpoint"]=this.url;else if("undefined"!=typeof XDomainRequest){a+="?X-App-Id="+this.appId+"&X-App-Key="+this.key;var h=this.auth.getToken();h&&(a+="&X-Auth-Token="+h)}return f.promise.xhr=uxhr((this.proxy||this.url)+a,d,{method:b,headers:e,sync:g,success:function(a){var b=null;try{b=JSON.parse(a)}catch(c){}b===!1||null===b||b.error?f.resolver.reject(b):f.resolver.resolve(b)},error:function(a){var b=null;try{b=JSON.parse(a)}catch(c){}console.log("Error: ",b||"invalid json response"),f.resolver.reject(b)}}),f.promise},d.Client.prototype.getHeaders=function(){var a,b={"X-App-Id":this.appId,"X-App-Key":this.key},a=this.auth.getToken();return a&&(b["X-Auth-Token"]=a),b},d.Client.prototype.getPayload=function(a,b){var c=null;if(b){if(b instanceof FormData)c=b;else if("GET"!==a){var d,e,f,g=new FormData,h=!1;for(d in b)if(e=b[d],f=null,"undefined"!=typeof e&&null!==e&&("string"==typeof e||(e instanceof HTMLInputElement&&e.files&&e.files.length>0?(f=e.files[0].name,e=e.files[0],h=!0):e instanceof HTMLInputElement?e=e.value:e instanceof HTMLCanvasElement?(e=dataURLtoBlob(e.toDataURL()),h=!0,f="canvas.png"):"undefined"!=typeof Blob&&e instanceof Blob&&(h=!0,f="blob."+e.type.match(/\/(.*)/)[1])),!(e instanceof Array)))try{g.append(d,e,f||"file")}catch(i){g.append(d,e)}h&&(c=g)}c=c||JSON.stringify(b),"GET"===a&&"string"==typeof c&&(c=encodeURIComponent(c))}return c},d.Client.prototype.serialize=function(a,b){var c=[];for(var d in a)if(a.hasOwnProperty(d)){var e=b?b+"["+d+"]":d,f=a[d];c.push("object"==typeof f?this.serialize(f,e):encodeURIComponent(e)+"="+encodeURIComponent(f))}return c.join("&")},d.Events=function(){this._events={}},d.Events.prototype.on=function(a,b,c){this._events[a]||(this._events[a]=[]),this._events[a].push({callback:b,context:c||this})},d.Events.prototype.trigger=function(a){var b,c=Array.prototype.slice.call(arguments,1);if(this._events[a])for(var d=0,e=this._events[a].length;e>d;d++)b=this._events[a][d],b.callback.apply(b.context||this.client,c)},d.Iterable=function(){},d.Iterable.prototype={each:function(a){return this._iterate("each",a)},find:function(a){return this._iterate("find",a)},filter:function(a){return this._iterate("filter",a)},max:function(a){return this._iterate("max",a)},min:function(a){return this._iterate("min",a)},every:function(a){return this._iterate("every",a)},reject:function(a,b){return this._iterate("reject",a,b)},groupBy:function(a,b){return this._iterate("groupBy",a,b)},_iterate:function(a,b,c){var d=when.defer();return this.then(function(e){var f=_[a].call(_,e,b,c);d.resolver.resolve(f)}).otherwise(function(a){d.resolver.reject(a)}),d.promise}},d.Plugin={},d.Plugin.Manager={plugins:[]},d.Plugin.Manager.register=function(a,b){this.plugins.push({path:a,klass:b})},d.Plugin.Manager.setup=function(a){for(var b=0,c=this.plugins.length;c>b;b++)a[this.plugins[b].path]=new this.plugins[b].klass(a)},d.Auth=function(b){this.client=b,this.currentUser=null;var c=new Date,e=new Date(1e3*parseInt(a.localStorage.getItem(this.client.appId+"-"+d.Auth.AUTH_TOKEN_EXPIRATION)||0,10)),f=a.localStorage.getItem(this.client.appId+"-"+d.Auth.AUTH_DATA_KEY);f&&c.getTime()<e.getTime()&&(this.currentUser=JSON.parse(f))},d.Auth.prototype=new d.Events,d.Auth.prototype.constructor=d.Auth,d.Auth.AUTH_DATA_KEY="dl-api-auth-data",d.Auth.AUTH_TOKEN_KEY="dl-api-auth-token",d.Auth.AUTH_TOKEN_EXPIRATION="dl-api-auth-token-expiration",d.Auth.prototype.setCurrentUser=function(b){return b?(a.localStorage.setItem(this.client.appId+"-"+d.Auth.AUTH_DATA_KEY,JSON.stringify(b)),this.currentUser=b,this.trigger("logged_in",b)):(this.trigger("logged_out",this.currentUser),this.currentUser=b,a.localStorage.removeItem(this.client.appId+"-"+d.Auth.AUTH_TOKEN_KEY),a.localStorage.removeItem(this.client.appId+"-"+d.Auth.AUTH_DATA_KEY)),this},d.Auth.prototype.register=function(a,b){var c,d=this;return"undefined"==typeof b&&(b={}),c=this.client.post("auth/"+a,b),c.then(function(a){d._registerToken(a)}),c},d.Auth.prototype.authenticate=function(){return console.log("auth.authenticate method is deprecated. Please use auth.register."),this.register.apply(this,arguments)},d.Auth.prototype.login=function(a,b){var c,d=this;return"undefined"==typeof b&&(b={}),c=this.client.post("auth/"+a+"/verify",b),c.then(function(a){d._registerToken(a)}),c},d.Auth.prototype.verify=function(){return console.log("auth.verify method is deprecated. Please use auth.login."),this.login.apply(this,arguments)},d.Auth.prototype.forgotPassword=function(a){return"undefined"==typeof a&&(a={}),this.client.post("auth/email/forgotPassword",a)},d.Auth.prototype.resetPassword=function(b){if("string"==typeof b&&(b={password:b}),"undefined"==typeof b.token&&(b.token=a.location.href.match(/[\?|&]token=([a-z0-9]+)/),b.token=b.token&&b.token[1]),"string"!=typeof b.token)throw new Error("forgot password token required. Remember to use 'auth.forgotPassword' before 'auth.resetPassword'.");if("string"!=typeof b.password)throw new Error("new password required.");return this.client.post("auth/email/resetPassword",b)},d.Auth.prototype.logout=function(){return this.setCurrentUser(null)},d.Auth.prototype.getToken=function(){return a.localStorage.getItem(this.client.appId+"-"+d.Auth.AUTH_TOKEN_KEY)},d.Auth.prototype._registerToken=function(b){b.token&&(a.localStorage.setItem(this.client.appId+"-"+d.Auth.AUTH_TOKEN_KEY,b.token.token),a.localStorage.setItem(this.client.appId+"-"+d.Auth.AUTH_TOKEN_EXPIRATION,b.token.expire_at),delete b.token,this.setCurrentUser(b))},d.Channel={},d.Collection=function(a,b){this.client=a,this.name=this._validateName(b),this.reset(),this.segments="collection/"+this.name},d.Collection.prototype=new d.Iterable,d.Collection.prototype.constructor=d.Collection,d.Collection.prototype.create=function(a){return this.client.post(this.segments,a)},d.Collection.prototype.get=function(){return this.client.get(this.segments,this.buildQuery())},d.Collection.prototype.where=function(a,b,c){var d,e="undefined"==typeof c?"=":b,f="undefined"==typeof c?b:c;if("object"==typeof a)for(d in a)a.hasOwnProperty(d)&&(a[d]instanceof Array?(e=a[d][0],f=a[d][1]):f=a[d],this.addWhere(d,e,f));else this.addWhere(a,e,f);return this},d.Collection.prototype.find=function(a){var b=this.client.get(this.segments+"/"+a,this.buildQuery());return arguments.length>1?b.then.apply(b,Array.prototype.slice.call(arguments,1)):b},d.Collection.prototype.group=function(){return this._group=arguments,this},d.Collection.prototype.count=function(){this.options.aggregation={method:"count",field:null};var a=this.get();return arguments.length>0&&a.then.apply(a,arguments),a},d.Collection.prototype.max=function(a){this.options.aggregation={method:"max",field:a};var b=this.get();return arguments.length>1&&b.then.apply(b,Array.prototype.slice.call(arguments,1)),b},d.Collection.prototype.min=function(a){this.options.aggregation={method:"min",field:a};var b=this.get();return arguments.length>1&&b.then.apply(b,Array.prototype.slice.call(arguments,1)),b},d.Collection.prototype.avg=function(a){this.options.aggregation={method:"avg",field:a};var b=this.get();return arguments.length>1&&b.then.apply(b,Array.prototype.slice.call(arguments,1)),b},d.Collection.prototype.sum=function(a){this.options.aggregation={method:"sum",field:a};var b=this.get();return arguments.length>1&&b.then.apply(b,Array.prototype.slice.call(arguments,1)),b},d.Collection.prototype.first=function(){this.options.first=1;var a=this.get();return a.then.apply(a,arguments),a},d.Collection.prototype.firstOrCreate=function(){throw new Error("Not implemented")},d.Collection.prototype.then=function(){var a=this.get();return a.then.apply(a,arguments),a},d.Collection.prototype.reset=function(){return this.options={},this.wheres=[],this.ordering=[],this._group=[],this._limit=null,this._offset=null,this},d.Collection.prototype.sort=function(a,b){return b?"number"==typeof b&&(b=-1===parseInt(b,10)?"desc":"asc"):b="asc",this.ordering.push([a,b]),this
},d.Collection.prototype.limit=function(a){return this._limit=a,this},d.Collection.prototype.offset=function(a){return this._offset=a,this},d.Collection.prototype.channel=function(){throw new Error("Not implemented.")},d.Collection.prototype.paginate=function(a,b,c){var e=new d.Pagination(this);return b||(b=a,a=d.defaults.perPage),this.options.paginate=a,this.then(function(a){e._fetchComplete(a),b&&b(e)},c),e},d.Collection.prototype.drop=function(){return this.client.remove(this.segments)},d.Collection.prototype.remove=function(a){var b=this.segments;return"undefined"!=typeof a&&(b+="/"+a),this.client.remove(b,this.buildQuery())},d.Collection.prototype.update=function(a,b){return this.client.post(this.segments+"/"+a,b)},d.Collection.prototype.increment=function(a,b){this.options.operation={method:"increment",field:a,value:b};var c=this.client.put(this.segments,this.buildQuery());return arguments.length>0&&c.then.apply(c,arguments),c},d.Collection.prototype.decrement=function(a,b){this.options.operation={method:"decrement",field:a,value:b};var c=this.client.put(this.segments,this.buildQuery());return arguments.length>0&&c.then.apply(c,arguments),c},d.Collection.prototype.updateAll=function(a){return this.options.data=a,this.client.put(this.segments,this.buildQuery())},d.Collection.prototype.addWhere=function(a,b,c){return this.wheres.push([a,b.toLowerCase(),c]),this},d.Collection.prototype._validateName=function(a){var b=/^[a-z_\/0-9]+$/;if(!b.test(a))throw new Error("Invalid name: "+a);return a},d.Collection.prototype.buildQuery=function(){var a={};null!==this._limit&&(a.limit=this._limit),null!==this._offset&&(a.offset=this._offset),this.wheres.length>0&&(a.q=this.wheres),this.ordering.length>0&&(a.s=this.ordering),this._group.length>0&&(a.g=this._group);var b,c={paginate:"p",first:"f",aggregation:"aggr",operation:"op",data:"data"};for(b in c)this.options[b]&&(a[c[b]]=this.options[b]);return this.reset(),a},d.CollectionItem=function(){},d.Files=function(a){this.client=a},d.Files.prototype.upload=function(a,b,c){var d=new FormData;if(a instanceof HTMLCanvasElement&&a.toBlob){var e=when.defer(),f=this;return a.toBlob(function(a){f.upload(a,b,c).then(e.resolver.resolve,e.resolver.reject)},c||"image/png"),e.promise}try{d.append("file",a,b||"dlApiFile")}catch(g){d.append("file",a)}return this.client.post("files",d)},d.Files.prototype.get=function(a){return this.client.get("files/"+a)},d.Files.prototype.remove=function(a){return this.client.remove("files/"+a)},d.KeyValues=function(a){this.client=a},d.KeyValues.prototype.get=function(a,b){var c=this.client.get("key/"+a);return b&&c.then.apply(c,[b]),c},d.KeyValues.prototype.set=function(a,b){return this.client.post("key/"+a,{value:b})},d.Pagination=function(a){this.fetching=!0,this.collection=a},d.Pagination.prototype._fetchComplete=function(a){this.fetching=!1,this.total=a.total,this.per_page=a.per_page,this.current_page=a.current_page,this.last_page=a.last_page,this.from=a.from,this.to=a.to,this.items=a.data},d.Pagination.prototype.hasNext=function(){return this.current_page<this.to},d.Pagination.prototype.isFetching=function(){return this.fetching},d.Pagination.prototype.then=function(){},d.System=function(a){this.client=a},d.System.prototype.time=function(){var a=this.client.get("system/time");return arguments.length>0&&a.then.apply(a,arguments),a},d.Channel.SSE=function(a,b,c){this.collection=b,this.client_id=null,this.callbacks={},this.options=c||{},this.readyState=null},d.Channel.SSE.prototype.subscribe=function(a,b){"undefined"==typeof b&&(b=a,a="_default"),this.callbacks[a]=b;var c=this.connect();if(this.readyState===EventSource.CONNECTING){var d=this;c.then(function(){d.event_source.onopen=function(a){d.readyState=a.readyState,d._trigger.apply(d,["state:"+a.type,a])},d.event_source.onerror=function(a){d.readyState=a.readyState,d._trigger.apply(d,["state:"+a.type,a])},d.event_source.onmessage=function(a){var b=JSON.parse(a.data),c=b.event;delete b.event,d._trigger.apply(d,[c,b])}})}return c},d.Channel.SSE.prototype._trigger=function(a,b){-1===a.indexOf("state:")&&this.callbacks._default&&this.callbacks._default.apply(this,[a,b]),this.callbacks[a]&&this.callbacks[a].apply(this,[b])},d.Channel.SSE.prototype.isConnected=function(){return null!==this.readyState&&this.readyState!==EventSource.CLOSED},d.Channel.SSE.prototype.unsubscribe=function(a){this.callbacks[a]&&(this.callbacks[a]=null)},d.Channel.SSE.prototype.publish=function(a,b){return"undefined"==typeof b&&(b={}),b.client_id=this.client_id,b.event=a,this.collection.create(b)},d.Channel.SSE.prototype.connect=function(){if(null!==this.readyState){var b=when.defer();return b.resolver.resolve(),b.promise}this.readyState=EventSource.CONNECTING,this._trigger.apply(this,["state:connecting"]);var c=this;return this.publish("connected").then(function(b){c.collection.where("updated_at",">",b.updated_at);var d="X-App-Id="+c.collection.client.appId+"&X-App-Key="+c.collection.client.key,e=c.collection.client.auth.getToken();e&&(d+="&X-Auth-Token="+e);var f=c.collection.buildQuery();f.stream={refresh:c.options.refresh_timeout||1,retry:c.options.retry_timeout||1},c.client_id=b.client_id,c.event_source=new EventSource(c.collection.client.url+c.collection.segments+"?"+d+"&"+JSON.stringify(f),{withCredentials:!0}),a.addEventListener("unload",function(){c.disconnect(!0)})},function(a){c.readyState=EventSource.CLOSED,c._trigger.apply(c,["state:error",a])})},d.Channel.SSE.prototype.disconnect=function(a){return this.isConnected()&&(this.close(),this.publish("disconnected",{_sync:"undefined"!=typeof a&&a})),this},d.Channel.SSE.prototype.close=function(){return this.event_source&&this.event_source.close(),this.readyState=EventSource.CLOSED,this},d.Channel.WEBSOCKETS=function(b,c,d){var e=this;if(this.client=b,this.collection=c,this.client_id=null,!d.url){var f="https:"===a.location.protocol?"wss://":"ws://",g=b.url.replace(/(?:https?:)?\/\//,f);g.match(/index\.php/)?g=g.replace("index.php","ws/"):g+="ws/",d.url=g}d.url+=this.collection.name+"?X-App-Id="+this.client.appId+"&X-App-Key="+this.client.key;var h=this.client.auth.getToken();h&&(d.url+="&X-Auth-Token="+h),d.debug&&ab.debug(!0,!0),ab.connect(d.url,function(a){e.ws=a,e.client_id=a.sessionid(),e.trigger("connected")})},d.Channel.WEBSOCKETS.prototype=new d.Events,d.Channel.WEBSOCKETS.prototype.constructor=d.Channel.WEBSOCKETS,d.Channel.WEBSOCKETS.prototype.subscribe=function(a,b){return this.ws.subscribe(this.collection.name+"."+a,function(a,c){b(c)}),this},d.Channel.WEBSOCKETS.prototype.isConnected=function(){return this.ws&&this.ws._websocket_connected},d.Channel.WEBSOCKETS.prototype.unsubscribe=function(a){return this.ws.unsubscribe(this.collection.name+"."+a),this},d.Channel.WEBSOCKETS.prototype.publish=function(a,b,c){var d=[],e=[];return"undefined"==typeof c&&(c={}),c.exclude&&c.exclude instanceof Array&&(d=c.exclude),c.eligible&&c.eligible instanceof Array&&(e=c.eligible),this.ws.publish(this.collection.name+"."+a,b,d,e),this},d.Channel.WEBSOCKETS.prototype.disconnect=function(){return this.ws.close(),this},d.Channel.WEBSOCKETS.prototype.call=function(a,b){return this.ws.call(a,b),this},d.Channel.WEBSOCKETS.prototype.connect=function(){return this.ws.connect(),this}}(this);